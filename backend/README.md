# Expense-Tracker Backend

Node.js + Express.js + MySQL backend for the Expense-Tracker application.

## Stack

- Node.js
- Express.js
- MySQL (mysql2)
- JWT authentication
- Role-based access (USER, ADMIN)

## Getting Started

1. Install dependencies:

```bash
cd backend
npm install
```

2. Configure environment variables:

Update `.env` in the `backend` directory with your local MySQL credentials and desired JWT secret.

3. Create the database schema in MySQL:

```sql
CREATE DATABASE IF NOT EXISTS expense_tracker CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE expense_tracker;

-- Users
CREATE TABLE IF NOT EXISTS users (
  id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  email VARCHAR(255) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  role ENUM('USER', 'ADMIN') NOT NULL DEFAULT 'USER',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

-- Categories (global or user-specific)
CREATE TABLE IF NOT EXISTS categories (
  id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  description VARCHAR(255) NULL,
  user_id INT UNSIGNED NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_categories_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
) ENGINE=InnoDB;

-- Expenses
CREATE TABLE IF NOT EXISTS expenses (
  id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  user_id INT UNSIGNED NOT NULL,
  category_id INT UNSIGNED NOT NULL,
  amount DECIMAL(10,2) NOT NULL,
  description VARCHAR(255) NULL,
  date DATE NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_expenses_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  CONSTRAINT fk_expenses_category FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE RESTRICT
) ENGINE=InnoDB;

-- Optional: seed an admin user (replace password hash with one generated by bcrypt)
INSERT INTO users (name, email, password, role)
VALUES ('Admin', 'admin@example.com', '$2b$10$replace_with_real_hash', 'ADMIN');
```

4. Run the server:

```bash
# Development (with nodemon)
npm run dev

# Production
npm start
```

## API Overview

### Auth

- `POST /api/auth/register` – Register a new user (default role USER unless ADMIN explicitly provided and allowed by business rules).
- `POST /api/auth/login` – Login for both USER and ADMIN. Returns JWT token and user info.

### User (requires JWT)

Base path: `/api/user`

- `GET /me` – Get current user profile.
- `POST /expenses` – Create an expense. Body: `{ categoryId, amount, description?, date }`.
- `GET /expenses` – List current user expenses.
- `DELETE /expenses/:id` – Delete an expense belonging to the current user.
- `POST /categories` – Create a user-specific category.
- `GET /categories` – List categories (global + user-specific).

### Admin (requires JWT with role ADMIN)

Base path: `/api/admin`

- `GET /users` – List all users.
- `GET /expenses` – List all expenses with user and category info.

## Notes

- Authentication is handled with JWT. Pass the token in the `Authorization` header as `Bearer <token>`.
- Role-based access is enforced using middleware that checks `req.user.role` decoded from JWT.
- Passwords are salted and hashed using `bcrypt` before storage.
